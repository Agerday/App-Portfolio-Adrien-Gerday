<app-page-layout>
  <app-page-header title="What colleagues say..." />

  <app-section>
    <!-- Testimonials Grid -->
    <div class="grid md:grid-cols-2 xl:grid-cols-3 gap-6 sm:gap-8">
      @for (testimonial of filteredTestimonials(); track testimonial.id; let i = $index) {
        <app-card
          class="group hover:-translate-y-2 transition-all duration-300 relative"
          data-aos="fade-up"
          [attr.data-aos-delay]="i * 100">

          <!-- Featured Badge -->
          @if (testimonial.featured) {
            <div class="absolute top-4 right-4 z-10">
              <span class="inline-flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-400 to-orange-500
                           text-white text-xs font-bold rounded-full shadow-lg">
                <span class="material-symbols-rounded text-[12px]">★</span>
                <span>Featured</span>
              </span>
            </div>
          }

          <!-- Centered content -->
          <div class="flex flex-col justify-center items-center h-full w-full text-center">
            <!-- Avatar -->
            <div class="mb-4">
              @if (testimonial.image) {
                <img
                  [src]="testimonial.image"
                  [alt]="testimonial.name"
                  class="w-16 h-16 rounded-full object-cover border-2 border-gray-200 dark:border-gray-600 mx-auto"
                />
              } @else {
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-600
                            flex items-center justify-center text-white font-bold text-lg mx-auto">
                  {{ getInitials(testimonial.name) }}
                </div>
              }
            </div>

            <!-- Name -->
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1">
              {{ testimonial.name }}
            </h3>

            <!-- Position -->
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">
              {{ testimonial.position }}
            </p>

            <!-- Company -->
            @if (testimonial.companyUrl) {
              <a
                [href]="testimonial.companyUrl"
                target="_blank"
                rel="noopener noreferrer"
                class="text-sm text-blue-600 dark:text-blue-400 hover:underline inline-flex items-center gap-1 mb-4">
                {{ testimonial.company }}
                <span class="material-symbols-rounded text-[14px]">open_in_new</span>
              </a>
            } @else {
              <p class="text-sm text-gray-500 dark:text-gray-500 mb-4">
                {{ testimonial.company }}
              </p>
            }

            <!-- Rating -->
            <div class="flex items-center gap-1 mb-4">
              @for (star of getRatingStars(testimonial.rating); track star) {
                <span class="material-symbols-rounded text-yellow-400 text-[20px]">★</span>
              }
            </div>

            <!-- Quote -->
            <blockquote class="text-gray-700 dark:text-gray-300 leading-relaxed mb-3 relative px-2">
              <span class="text-4xl text-blue-500/20 absolute -top-1 left-0 leading-none">"</span>
              <p class="relative text-sm italic">{{ testimonial.quote }}</p>
              <span class="text-4xl text-blue-500/20 absolute -bottom-2 right-0 leading-none">"</span>
            </blockquote>

            <!-- Date -->
            <p class="text-xs text-gray-500 dark:text-gray-500 mb-4">
              {{ formatDate(testimonial.date) }}
            </p>

            <!-- Tags -->
            @if (testimonial.tags.length > 0) {
              <div class="flex flex-wrap justify-center gap-2 mb-4">
                @for (tag of testimonial.tags.slice(0, 3); track tag) {
                  <span class="px-2.5 py-1 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400
                               text-xs font-medium rounded-lg border border-blue-200 dark:border-blue-800">
                    {{ tag }}
                  </span>
                }
              </div>
            }

            <!-- Related Projects -->
            @if (getProjectLinks(testimonial.projectId).length > 0) {
              <div class="w-full pt-4 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-center gap-2 mb-2">
                  <span class="material-symbols-rounded text-[16px] text-gray-600 dark:text-gray-400">work</span>
                  <span class="text-xs font-medium text-gray-600 dark:text-gray-400">
                    Related Project{{ getProjectLinks(testimonial.projectId).length > 1 ? 's' : '' }}
                  </span>
                </div>
                <div class="flex flex-wrap justify-center gap-2">
                  @for (project of getProjectLinks(testimonial.projectId); track project.id) {
                    <a
                      [href]="['/projects', project.id]"
                      class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-blue-50 to-purple-50
                             dark:from-blue-900/20 dark:to-purple-900/20 text-blue-600 dark:text-blue-400
                             text-xs font-medium rounded-lg border border-blue-200 dark:border-blue-800
                             hover:shadow-md hover:scale-105 transition-all group/link">
                      <span class="truncate max-w-[180px]">{{ project.title }}</span>
                      <span class="material-symbols-rounded text-[14px] group-hover/link:translate-x-0.5 transition-transform">arrow_forward</span>
                    </a>
                  }
                </div>
              </div>
            }
          </div>
        </app-card>
      }
    </div>
  </app-section>

  <!-- CTA Section -->
  <app-cta-section
    icon="handshake"
    title="Ready to Work Together?"
    description="Join these satisfied colleagues and let's build something amazing together. I'm committed to delivering excellence in every project."
    [buttons]="[
      { label: 'Start a Project', route: '/contact', variant: 'primary' },
      { label: 'View Projects', route: '/projects', variant: 'white' }
    ]"
  />
</app-page-layout>
