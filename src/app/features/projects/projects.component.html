<app-page-layout>
  <app-page-header
    title="Projects"
    subtitle="Building scalable applications with modern technologies"
  />

  <!-- Filters Section -->
  <app-section>
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-200 dark:border-gray-700 shadow-lg">
      <!-- Search Bar -->
      <div class="mb-6">
        <app-search-input
          [value]="searchQuery()"
          (valueChange)="searchQuery.set($event)"
          placeholder="Search projects by name or technology..."
        />
      </div>

      <!-- Category Filters -->
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-sm font-semibold text-gray-700 dark:text-gray-300 mr-2">Category:</span>

          <button
            (click)="selectedCategory.set('all')"
            [class]="selectedCategory() === 'all'
              ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-md shadow-blue-500/30'
              : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 ' +
               'dark:hover:bg-gray-600'"
            class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2"
          >
            <span>All Projects</span>
            <span class="px-2 py-0.5 bg-white/20 dark:bg-black/20 rounded-full text-xs font-bold">
              {{ projects.length }}
            </span>
          </button>

          @for (category of categories; track category.value) {
            <button
              (click)="selectedCategory.set(category.value)"
              [class]="selectedCategory() === category.value
                ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-md shadow-blue-500/30'
                : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 ' +
                 'dark:hover:bg-gray-600'"
              class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2"
            >
              <span>{{ category.label }}</span>
              <span class="px-2 py-0.5 bg-white/20 dark:bg-black/20 rounded-full text-xs font-bold">
                {{ getProjectCountByCategory(category.value) }}
              </span>
            </button>
          }
        </div>

        <!-- Clear Filters -->
        @if (hasActiveFilters()) {
          <button
            (click)="clearAllFilters()"
            class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium
            text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 hover:bg-red-100
            dark:hover:bg-red-900/30 rounded-lg transition-colors"
          >
            <span class="material-symbols-rounded text-[18px]">close</span>
            <span>Clear Filters</span>
          </button>
        }
      </div>

      <!-- Active Filters Summary -->
      @if (hasActiveFilters()) {
        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
          <div class="flex items-center gap-2 text-sm">
            <span class="material-symbols-rounded text-blue-500 text-[20px]">filter_alt</span>
            <span class="text-gray-600 dark:text-gray-400">
              Showing
              <span class="font-bold text-blue-600 dark:text-blue-400">{{ filteredProjects().length }}</span>
              {{ filteredProjects().length === 1 ? 'project' : 'projects' }}
              @if (selectedCategory() !== 'all') {
                <span> in <span class="font-semibold">{{ getCategoryLabel(selectedCategory()) }}</span></span>
              }
              @if (searchQuery()) {
                <span> matching "<span class="font-semibold">{{ searchQuery() }}</span>"</span>
              }
            </span>
          </div>
        </div>
      }
    </div>
  </app-section>

  <!-- Projects Grid -->
  <app-section>
    @if (filteredProjects().length === 0) {
      <app-empty-state
        icon="search_off"
        title="No projects found"
        description="Try adjusting your search or category filters to see more results"
        actionLabel="Clear All Filters"
        (action)="clearAllFilters()"
      />
    } @else {

      <!-- Featured Projects First -->
      @if (showFeaturedSection()) {
        <div class="mb-12">
          <div class="flex items-center gap-3 mb-6">
            <span class="material-symbols-rounded text-yellow-600 dark:text-yellow-400 text-[28px]">star</span>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Featured Projects</h2>
          </div>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            @for (project of filteredFeatured(); track project.id) {
              <app-project-card
                [project]="project"
                [categoryLabel]="getCategoryLabel(project.category)"
                (liveClick)="trackProjectClick(project.id, 'live')"
                (githubClick)="trackProjectClick(project.id, 'github')"
                (detailClick)="trackProjectClick(project.id, 'view')"
              />
            }
          </div>
        </div>
      }

      <!-- All Projects -->
      <div>
        @if (showFeaturedSection()) {
          <div class="flex items-center gap-3 mb-6">
            <span class="material-symbols-rounded text-blue-600 dark:text-blue-400 text-[28px]">apps</span>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">All Projects</h2>
          </div>
        }

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          @for (project of showFeaturedSection() ? filteredNonFeatured() : filteredProjects(); track project.id) {
            <app-project-card
              [project]="project"
              [categoryLabel]="getCategoryLabel(project.category)"
              (liveClick)="trackProjectClick(project.id, 'live')"
              (githubClick)="trackProjectClick(project.id, 'github')"
              (detailClick)="trackProjectClick(project.id, 'view')"
            />
          }
        </div>
      </div>
    }
  </app-section>
</app-page-layout>
